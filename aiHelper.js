// aiHelper.js
const Groq = require("groq-sdk");

const client = new Groq({ apiKey: process.env.GROQ_API_KEY });

// ðŸ”¹ Ask the AI assistant
async function askAI(userMessage) {
  try {
    console.log("ðŸ¤– DEBUG => Sending message to AI:", userMessage);

    const systemPrompt = `
Ø£Ù†Øª Ù…ÙˆØ¸Ù Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ Ø°ÙƒÙŠ ÙÙŠ Ø¹ÙŠØ§Ø¯Ø© Ø·Ø¨ÙŠØ©. 
Ø¯ÙˆØ±Ùƒ Ø£Ù† ØªØ±Ø¯ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ù€:
- Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ðŸ•’
- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ðŸ’°
- Ø§Ù„Ù…ÙˆÙ‚Ø¹ ðŸ“
- Ø§Ù„Ø­Ø¬Ø² ðŸ“…

ðŸ”’ Ù‚ÙˆØ§Ø¹Ø¯ ØµØ§Ø±Ù…Ø©:
1. Ù„Ø§ ØªÙƒØªØ¨ Ø£ÙŠ Ø´ÙŠØ¡ Ø®Ø§Ø±Ø¬ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø¥Ø·Ù„Ø§Ù‚Ù‹Ø§.
2. Ø¥Ø°Ø§ Ø³ÙØ¦Ù„Øª Ø¹Ù† Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŒ Ù‚Ù„ Ø¨Ø£Ø¯Ø¨:
   "Ø£Ø³ØªØ·ÙŠØ¹ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ØŒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ù„Ø­Ø¬Ø²."
3. Ù„Ø§ ØªØ¨ØªÙƒØ± Ø£Ùˆ ØªØ®Ù…Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª.
4. Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ØªØ£ÙƒØ¯Ù‹Ø§ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©ØŒ Ù‚Ù„:
   "Ø¯Ø¹Ù†ÙŠ Ø£Ø¤ÙƒØ¯ Ù„Ùƒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„."
5. ØªÙƒÙ„Ù‘Ù… Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰ Ø¨Ø§Ø­ØªØ±Ø§Ù… ÙˆÙ…Ù‡Ù†ÙŠØ©.
6. Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ø±Ù…ÙˆØ² Ø£Ùˆ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø¥Ù„Ø§ Ù†Ø§Ø¯Ø±Ù‹Ø§.
`;

    const completion = await client.chat.completions.create({
      model: "llama-3.3-70b-versatile",
      messages: [
        { role: "system", content: systemPrompt },
        { role: "user", content: userMessage },
      ],
      temperature: 0.7,
      max_completion_tokens: 512,
    });

    const reply =
      completion.choices[0]?.message?.content || "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ÙÙ‡Ù… Ø³Ø¤Ø§Ù„Ùƒ.";
    console.log("ðŸ¤– DEBUG => AI Reply:", reply);
    return reply;
  } catch (err) {
    console.error("âŒ DEBUG => AI Error:", err.response?.data || err.message);
    return "âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ.";
  }
}

// ðŸ”¹ Validate name using AI
async function validateNameWithAI(name) {
  try {
    const prompt = `
Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø®Ù„ Ù‡Ùˆ: "${name}"
Ù‡Ù„ Ù‡Ø°Ø§ ÙŠØ¨Ø¯Ùˆ ÙƒØ§Ø³Ù… Ø´Ø®Øµ Ø­Ù‚ÙŠÙ‚ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø«Ù„ Ø£Ø­Ù…Ø¯ØŒ Ù…Ø­Ù…Ø¯ØŒ Ø¹Ù„ÙŠØŒ Ø±ÙŠÙ…ØŒ Ø³Ø§Ø±Ø©ØŸ
Ø£Ø¬Ø¨ ÙÙ‚Ø· Ø¨Ù€ "Ù†Ø¹Ù…" Ø£Ùˆ "Ù„Ø§".
`;
    const completion = await client.chat.completions.create({
      model: "llama-3.3-70b-versatile",
      messages: [{ role: "user", content: prompt }],
      temperature: 0,
      max_completion_tokens: 10,
    });

    const reply = completion.choices[0]?.message?.content?.trim();
    console.log("ðŸ¤– DEBUG => Name validation reply:", reply);
    return reply && reply.startsWith("Ù†Ø¹Ù…");
  } catch (err) {
    console.error("âŒ DEBUG => Name validation error:", err.message);
    return false;
  }
}

module.exports = { askAI, validateNameWithAI };
